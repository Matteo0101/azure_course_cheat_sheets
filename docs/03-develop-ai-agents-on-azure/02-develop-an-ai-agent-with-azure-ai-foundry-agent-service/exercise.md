# Azure AI Agent with Code Interpreter - Complete Guide

üß© **Problem**
You need to analyze a dataset and generate charts dynamically based on user input, using an AI agent that interprets and executes code in real-time.

‚òÅÔ∏è **Solution with Azure**
Use **Azure AI Agent Service** with the **Code Interpreter tool** to build an agent capable of interpreting a dataset, responding to user prompts, and generating image-based charts.

üîß **Required Components**
* Azure AI Foundry portal (https://ai.azure.com)
* Azure subscription + resource group
* Azure AI Foundry project (auto-deploys GPT-4o)
* Agent playground + endpoint
* Azure portal Cloud Shell (PowerShell mode)
* GitHub repo: `https://github.com/MicrosoftLearning/mslearn-ai-agents`
* Python environment + packages (`azure-ai-projects`, etc.)
* `.env` configuration file with project endpoint
* Azure CLI (`az login`)
* Required Python packages via `pip install -r requirements.txt azure-ai-projects`

üèóÔ∏è **Architecture / Development**

1. **Create an Azure AI Foundry Project**
   * Use Azure AI Foundry portal to create a new agent project.
   * Ensure correct subscription, region, and resource group settings.
   * Save the endpoint URL for client use.

2. **Setup Local Environment in Cloud Shell**
   * Switch to PowerShell + Classic UI.
   * Clone lab repo ‚Üí `mslearn-ai-agents`
   * Navigate to: `ai-agents/Labfiles/02-build-ai-agent/Python`

3. **Configure App**
   * Create virtual env: `python -m venv labenv`
   * Activate: `./labenv/bin/Activate.ps1`
   * Install dependencies.
   * Edit `.env`: set `project_endpoint`

4. **Implement Agent Code**
   * Import libraries: `AgentsClient`, `CodeInterpreterTool`, etc.
   * Connect to `AgentsClient` using `DefaultAzureCredential`
   * Upload data file: `data.txt`
   * Create a `CodeInterpreterTool` referencing uploaded file
   * Create an agent with:
      * model = GPT-4o
      * name = "data-agent"
      * instruction = analyze + generate chart if requested
   * Start a thread, create user messages, and process run
   * Retrieve latest agent response
   * Loop for user input (`quit` to exit)
   * List entire message history (chronological)
   * Save any generated `.png` chart files locally
   * Clean up agent + thread after completion

5. **Run the App**
   * Sign in to Azure with `az login`
   * Run app: `python agent.py`
   * Interact: ask analysis questions + request charts

6. **Download Output Files**
   * Use `download ./.png` to retrieve generated chart images

‚úÖ **Best Practices / Considerations**
* ‚úÖ Use **PowerShell** in **Classic Cloud Shell** to enable the code editor
* ‚úÖ Save the **Azure Foundry endpoint** securely for SDK access
* ‚úÖ Maintain **proper code indentation** when modifying `agent.py`
* ‚úÖ Monitor for **rate limits** and **region quotas** on GPT-4o
* ‚úÖ Ensure **resource cleanup** via Azure Portal to avoid billing
* ‚ö†Ô∏è Technologies used are **in preview** ‚Äì behavior may be unstable
* ‚ö†Ô∏è Some features like **image file access** might not return contents (limitation noted)

‚ùì **Sample Exam Questions**

1. **You need to build an agent that analyzes uploaded data and creates visual charts. Which Azure AI tool allows dynamic code execution within the agent context?**
   * A. Azure Machine Learning Notebook
   * B. Code Interpreter Tool
   * C. Azure Logic Apps
   * D. Prompt Flow Tool 
   
   ‚úÖ **Correct answer: B**

2. **What configuration file must be updated to connect a local app to an Azure AI Foundry project?**
   * A. settings.json
   * B. project.config
   * C. .env
   * D. credentials.yaml 
   
   ‚úÖ **Correct answer: C**

3. **Which method is used to upload the data file to the Azure AI Foundry agent project?**
   * A. agent.upload_data(file_path)
   * B. client.upload_data_to_agent(file)
   * C. files.upload(file)
   * D. files.upload_and_poll(file_path, purpose=FilePurpose.AGENTS) 
   
   ‚úÖ **Correct answer: D**

4. **What is the purpose of the agent's thread in the implementation?**
   * A. To deploy the model
   * B. To execute Python code
   * C. To maintain stateful conversation context
   * D. To enable real-time streaming 
   
   ‚úÖ **Correct answer: C**

5. **Which command should be used to retrieve and save images generated by the agent?**
   * A. get_images()
   * B. agent.download_charts()
   * C. agent_client.files.save(file_id, file_name)
   * D. export_charts_as_png() 
   
   ‚úÖ **Correct answer: C**